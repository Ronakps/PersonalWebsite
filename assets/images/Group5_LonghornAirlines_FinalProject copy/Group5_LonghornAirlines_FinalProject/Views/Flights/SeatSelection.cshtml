@model Group5_LonghornAirlines_FinalProject.Models.ReservationEmbryo

@{
    ViewData["Title"] = "Select Seat";
}

<div style="margin-bottom: 20px; margin-top: 30px;">
    <a asp-action="Index" class="btn btn-danger">Return to Search</a>
</div>

<h4>Flight Details</h4>
@if (Model != null && Model.Flight.FlightPath != null)
{
    <table class="table">
        <thead>
            <tr>
                <th>Flight Number</th>
                <th>Departure Time</th>
                <th>Departure City</th>
                <th>Arrival City</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>@Model.Flight.FlightNumber</td>
                <td>@Model.Flight.DepartureTime.ToShortTimeString()</td>
                <td>@Model.Flight.FlightPath.DepartureCity</td>
                <td>@Model.Flight.FlightPath.ArrivalCity</td>
            </tr>
        </tbody>
    </table>



    <h4>Flyers Added</h4>
    <form asp-action="ConfirmSeatSelection" asp-controller="Flights" method="get">
    @* <form asp-action="ConfirmSeatSelection" asp-controller="Flights" asp-route-flyers="@Model.Flyers" asp-route-flight="@Model.Flight" method="post"> *@
        <table class="table">
        <thead>
            <tr>
                <th>Full Name</th>
                <th>Advantage Number</th>
                <th>Discount Type</th> <!-- New column -->
                <th>Choose Seat Number</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var flyer in Model.Flyers)
            {
                <tr>
                    <td>@($"{flyer.Customer.FirstName} {flyer.Customer.LastName}")</td>
                    <td>@flyer.Customer.AdvantageNumber</td>
                    <td>@GetDiscountTypeString(flyer.DiscountType)</td>
                    <td>
                        <select asp-for="@flyer.SelectedSeat" asp-items="Html.GetEnumSelectList<Seat>()">
                            <option value="">Choose Seat</option>
                        </select>
                    </td>
                </tr>
            }
        </tbody>
        <div class="form-group">
            <input type="submit" value="Proceed" class="btn btn-success" />
        </div>
    </table>
    </form>




    <h4>Select a Seat</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Row</th>
                <th>Seats</th>
                <th>Seats</th>
                <th>Seats</th>
                <th>Seats</th>
            </tr>
        </thead>
        <tbody>
            @{
                var rows = new[]
                {
                    new { Row = 1, Seats = new[] { "A1", "", "", "B1" } },
                    new { Row = 2, Seats = new[] { "A2", "", "", "B2" } },
                    new { Row = 3, Seats = new[] { "A3", "B3", "C3", "D3" } },
                    new { Row = 4, Seats = new[] { "A4", "B4", "C4", "D4" } },
                    new { Row = 5, Seats = new[] { "A5", "B5", "C5", "D5" } }
                };
            }
            @foreach (var row in rows)
            {
                <tr>
                    <td>@row.Row</td>
                    @foreach (var seat in row.Seats)
                    {
                        var ticketWithSeat = Model.Flight.Tickets.FirstOrDefault(t => t.Seat.ToString() == seat);
                        var seatTaken = ticketWithSeat != null;
                        var textColor = seatTaken ? "red" : "green";
                        var seatColor = "inherit"; // Default color

                        // Check if the seat is one of the specified special seats
                        if (seat == "A1" || seat == "B1" || seat == "A2" || seat == "B2")
                        {
                            if (seatTaken)
                            {
                                textColor = "red"; // Red text if taken
                            }
                            else
                            {
                                textColor = "darkblue"; // Dark blue text if available
                            }
                        }

                        <td class="seat-cell">
                            <span class="seat" style="color: @textColor;">@seat</span>
                        </td>
                    }
                </tr>
            }

        </tbody>
    </table>
}
else
{
    <p>Flight details are not available.</p>
}

@functions {
    public string GetDiscountTypeString(DiscountType discountType)
    {
        switch (discountType)
        {
            case DiscountType.None:
                return "None";
            case DiscountType.Senior:
                return "Senior";
            case DiscountType.Child:
                return "Child";
            // Add more cases if needed
            default:
                return "Unknown";
        }
    }
}
