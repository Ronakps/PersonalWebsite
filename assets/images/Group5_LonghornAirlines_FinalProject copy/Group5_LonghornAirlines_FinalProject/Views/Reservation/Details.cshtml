@model Group5_LonghornAirlines_FinalProject.Models.Reservation

@{
    ViewData["Title"] = "Details";
}

<h1>Reservation Details</h1>

@if (!string.IsNullOrEmpty(ViewBag.MilesMessage))
{
    <div class="alert alert-danger" role="alert">
        @ViewBag.MilesMessage
    </div>
}

@if (!string.IsNullOrEmpty(ViewBag.FlightMisMatchError))
{
    <div class="alert alert-danger" role="alert">
        @ViewBag.FlightMisMatchError
    </div>
}

@if (!string.IsNullOrEmpty(ViewBag.SameSeatsError))
{
    <div class="alert alert-danger" role="alert">
        @ViewBag.SameSeatsError
    </div>
}

@if (!string.IsNullOrEmpty(ViewBag.ConcurrentFlightFound))
{
    <div class="alert alert-danger" role="alert">
        @ViewBag.ConcurrentFlightFound
    </div>
}

@if (!string.IsNullOrEmpty(ViewBag.UserOnConflictingFlight))
{
    <div class="alert alert-danger" role="alert">
        @ViewBag.UserOnConflictingFlight
    </div>
}

<div class="card">
    <div class="card-header">
        Reservation Information
    </div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Primary Reserver:</dt>
            <dd class="col-sm-9">@Model.User.FirstName @Model.User.LastName</dd>

            <dt class="col-sm-3">Reservation Number:</dt>
            <dd class="col-sm-9">@Model.ReservationNumber</dd>

            <dt class="col-sm-3">Price:</dt>
            <dd class="col-sm-9">@Model.Total.ToString("C2")</dd>

            <dt class="col-sm-3">Price in Miles:</dt>
            <dd class="col-sm-9">@Model.PriceInMilesTotal.ToString("N0")</dd>

            <dt class="col-sm-3">Payment Type:</dt>
            <dd class="col-sm-9">@Model.PaymentType</dd>

            <dt class="col-sm-3">Reservation Status:</dt>
            <dd class="col-sm-9">@Model.ReservationStatus</dd>
        </dl>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        Flight Details
    </div>
    <div class="card-body">
        @foreach (var flight in Model.Tickets.Select(ticket => ticket.Flight).Distinct())
        {
            <dl class="row">
                <dt class="col-sm-3">Flight Departure Time:</dt>
                <dd class="col-sm-9">@flight.DepartureTime.ToString("yyyy-MM-dd HH:mm")</dd>

                <dt class="col-sm-3">Departure City:</dt>
                <dd class="col-sm-9">@flight.FlightPath.DepartureCity</dd>

                <dt class="col-sm-3">Arrival City:</dt>
                <dd class="col-sm-9">@flight.FlightPath.ArrivalCity</dd>
            </dl>
        }
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        Ticket Details
    </div>
    <div class="card-body">
        @foreach (var ticket in Model.Tickets)
        {
            <div class="card mb-3">
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">Name:</dt>
                        <dd class="col-sm-9">@ticket.TicketHolder.FirstName @ticket.TicketHolder.LastName</dd>

                        <dt class="col-sm-3">Ticket ID:</dt>
                        <dd class="col-sm-9">@ticket.TicketID</dd>

                        <dt class="col-sm-3">Seat:</dt>
                        <dd class="col-sm-9">@ticket.Seat</dd>

                        <dt class="col-sm-3">Seat Class:</dt>
                        <dd class="col-sm-9">@ticket.SeatStatus</dd>

                        <dt class="col-sm-3">Status:</dt>
                        <dd class="col-sm-9">@ticket.TicketStatus</dd>

                        <dt class="col-sm-3">Miles Earned [Updates After Departure]:</dt>
                        <dd class="col-sm-9">@ticket.MilesEarned</dd>
                    </dl>
                </div>
            </div>
        }
    </div>
</div>

<h5>Reservation Summary</h5>

@if (Model.PaymentType == PaymentType.Cash)
{
    <table class="table table-sm table-bordered" style="width:30%">
        <tr>
            <th>Reservation Subtotal:</th>
            <td>@Model.Subtotal.ToString("C2")</td>
        </tr>
        <tr>
            <th>Taxes:</th>
            <td>@Model.Tax.ToString("C2")</td>
        </tr>
        <tr>
            <th>Reservation Total:</th>
            <td>@Model.Total.ToString("C2")</td>
        </tr>
    </table>
}
else
{
    <table class="table table-sm table-bordered" style="width:30%">
        <tr>
            <th>Miles Spent:</th>
            <td>@Model.PriceInMilesTotal.ToString("N0")</td>
        </tr>
    </table>
}

<div class="mt-4">
    <a class="btn btn-primary" asp-action="Edit" asp-route-id="@Model.ReservationID" asp-route-flightId="@Model.RequestedFlightNum">Edit</a>
    <a class="btn btn-secondary" asp-action="Index">Back to Reservations</a>
    <a class="btn btn-secondary" asp-action="Start" asp-controller="Tickets" asp-route-reservationID="@Model.ReservationID" asp-route-flightId="@Model.RequestedFlightNum">Add Ticket</a>
</div>
